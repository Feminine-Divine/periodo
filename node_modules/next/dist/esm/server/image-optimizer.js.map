{"version":3,"sources":["../../server/image-optimizer.ts"],"names":["mediaType","createHash","promises","getOrientation","Orientation","imageSizeOf","isAnimated","contentDisposition","join","nodeUrl","processBuffer","decodeBuffer","getMetadata","sendEtagResponse","getContentType","getExtension","chalk","mockRequest","hasMatch","getImageBlurSvg","AVIF","WEBP","PNG","JPEG","GIF","SVG","CACHE_VERSION","ANIMATABLE_TYPES","VECTOR_TYPES","BLUR_IMG_SIZE","BLUR_QUALITY","sharp","require","process","env","NEXT_SHARP_PATH","e","showSharpMissingWarning","NODE_ENV","getSupportedMimeType","options","accept","mimeType","includes","getHash","items","hash","item","update","String","digest","replace","writeToCacheDir","dir","extension","maxAge","expireAt","buffer","etag","filename","rm","force","recursive","catch","rmdir","mkdir","writeFile","detectContentType","every","b","i","ImageOptimizerCache","validateParams","req","query","nextConfig","isDev","imageData","images","deviceSizes","imageSizes","domains","minimumCacheTTL","formats","remotePatterns","url","w","q","href","errorMessage","Array","isArray","isAbsolute","startsWith","hrefParsed","URL","toString","_error","protocol","width","parseInt","isNaN","sizes","push","isValidSize","quality","headers","isStatic","basePath","getCacheKey","constructor","distDir","cacheDir","get","cacheKey","files","readdir","now","Date","file","maxAgeSt","expireAtSt","split","readFile","Number","value","kind","revalidateAfter","Math","max","curRevalidate","isStale","_","set","revalidate","Error","err","console","error","ImageError","statusCode","message","parseCacheControl","str","map","Map","directive","key","trim","toLowerCase","getMaxAge","age","endsWith","slice","n","optimizeImage","contentType","height","nextConfigOutput","optimizedBuffer","transformer","rotate","resize","metaWidth","metadata","avif","avifQuality","chromaSubsampling","warn","yellow","bold","webp","png","jpeg","toBuffer","orientation","operations","RIGHT_TOP","type","numRotations","BOTTOM_RIGHT","LEFT_BOTTOM","imageOptimizer","_req","_res","paramsResult","handleRequest","upstreamBuffer","upstreamType","upstreamRes","fetch","ok","status","Buffer","from","arrayBuffer","resBuffers","mockReq","res","mockRes","streamPromise","isStreamFinished","method","connection","parse","concat","getHeader","dangerouslyAllowSVG","vector","animate","output","meta","opts","blurWidth","blurHeight","blurDataURL","unescape","getFileNameWithExtension","urlWithoutQueryParams","fileNameWithExtension","pop","fileName","setResponseHeaders","xCache","contentSecurityPolicy","setHeader","finished","sendResponse","result","byteLength","end","getImageSize","Deferred","promise","Promise","resolve","reject"],"mappings":"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"}